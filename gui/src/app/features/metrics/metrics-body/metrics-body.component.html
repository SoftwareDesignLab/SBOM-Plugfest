<div class="metrics-body flex col center">
  <div class="flex buttons">
    <app-button (click)="showPassed = !showPassed" *ngIf="result">
      Show {{ showPassed ? "Failed Only" : "Passed" }}
    </app-button>
    <app-button
      class="hover"
      [backgroundColor]="getLabelColor(processor)"
      *ngFor="let processor of processors"
      [ngStyle]="{opacity: processorIgnoreList.includes(processor) ? '100%' : '20%'}"
      (click)="toggleProcessorFilter(processor)"
    >
      {{ processor }}
    </app-button>
    <app-button
      class="hover"
      [ngStyle]="{opacity: processorIgnoreList.length > 0 ? '100%' : '20%'}"
      *ngIf="result"
      (click)="processorIgnoreList = [];"
    >
    Clear Filters
    </app-button>
  </div>
  <div class="results" *ngIf="result && qr">
    <app-accordion *ngFor="let identifier of identifiers">

      <div title>
        {{identifier}}
      </div>

      <div body>
        <ng-container *ngFor="let message of getIdentifierMessages(identifier)">
          <app-accordion
            class="merged-result"
            *ngIf="((!showPassed && 
              qr.mergedResults[identifier][message][0].pass !== 1) || 
              (showPassed && qr.mergedResults[identifier][message][0].pass === 1)) && 
              (processorIgnoreList.length === 0 || processorIgnoreList.includes(qr.mergedResults[identifier][message][0].processor))"
            [extra]="[
              getGrade(
                qr.mergedResults[identifier][message][0].pass
              ).toString()
            ]"
            [color]="getResultColor(qr.mergedResults[identifier][message][0])"
          >
            <div title>{{ identifier }}: {{ message }}</div>
            <div
              body
              *ngFor="let result of getMergedResult(identifier, message)"
            >
              {{ getTestMessage(result) }}
            </div>
          </app-accordion>
        </ng-container>
      </div>
    </app-accordion>

    <div class="text flex center" *ngIf="result === null">
      Please select an SBOM to see test results
    </div>
    <div class="text flex center" *ngIf="result && result.length === 0 && identifiers.length === 0">
      There are no test results with the selected SBOM
    </div>    
  </div>
</div>
